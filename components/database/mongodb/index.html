<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>MongoDB | KILLAR&#39;S BLOG</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.5.2">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.css">
    <[object Object]></[object Object]>
    <meta name="description" content="种一棵树最好的时间是十年前，其次是现在">
    <link rel="preload" href="/vuepress.github.io/assets/css/0.styles.0b6018b1.css" as="style"><link rel="preload" href="/vuepress.github.io/assets/js/app.ba1ea9b6.js" as="script"><link rel="preload" href="/vuepress.github.io/assets/js/2.fc02e046.js" as="script"><link rel="preload" href="/vuepress.github.io/assets/js/8.bf485cae.js" as="script"><link rel="prefetch" href="/vuepress.github.io/assets/js/10.1300801c.js"><link rel="prefetch" href="/vuepress.github.io/assets/js/11.56b53ed5.js"><link rel="prefetch" href="/vuepress.github.io/assets/js/12.df0caf41.js"><link rel="prefetch" href="/vuepress.github.io/assets/js/13.f464cad7.js"><link rel="prefetch" href="/vuepress.github.io/assets/js/14.090823b1.js"><link rel="prefetch" href="/vuepress.github.io/assets/js/15.d541e777.js"><link rel="prefetch" href="/vuepress.github.io/assets/js/16.37d11882.js"><link rel="prefetch" href="/vuepress.github.io/assets/js/17.a12739b5.js"><link rel="prefetch" href="/vuepress.github.io/assets/js/18.38751be7.js"><link rel="prefetch" href="/vuepress.github.io/assets/js/19.c66235c6.js"><link rel="prefetch" href="/vuepress.github.io/assets/js/20.133bcb93.js"><link rel="prefetch" href="/vuepress.github.io/assets/js/21.a193bcac.js"><link rel="prefetch" href="/vuepress.github.io/assets/js/22.31928e21.js"><link rel="prefetch" href="/vuepress.github.io/assets/js/23.7bcb1681.js"><link rel="prefetch" href="/vuepress.github.io/assets/js/24.6bb0b429.js"><link rel="prefetch" href="/vuepress.github.io/assets/js/25.0d80a0db.js"><link rel="prefetch" href="/vuepress.github.io/assets/js/26.20521376.js"><link rel="prefetch" href="/vuepress.github.io/assets/js/27.dc404bc6.js"><link rel="prefetch" href="/vuepress.github.io/assets/js/28.8e07fd85.js"><link rel="prefetch" href="/vuepress.github.io/assets/js/29.8800b1ae.js"><link rel="prefetch" href="/vuepress.github.io/assets/js/3.ddd9ca10.js"><link rel="prefetch" href="/vuepress.github.io/assets/js/30.de2774b1.js"><link rel="prefetch" href="/vuepress.github.io/assets/js/31.7775b765.js"><link rel="prefetch" href="/vuepress.github.io/assets/js/32.1c7bf669.js"><link rel="prefetch" href="/vuepress.github.io/assets/js/33.ea70e671.js"><link rel="prefetch" href="/vuepress.github.io/assets/js/4.c1ad3322.js"><link rel="prefetch" href="/vuepress.github.io/assets/js/5.cade1933.js"><link rel="prefetch" href="/vuepress.github.io/assets/js/6.6137ad34.js"><link rel="prefetch" href="/vuepress.github.io/assets/js/7.7149568d.js"><link rel="prefetch" href="/vuepress.github.io/assets/js/9.bca2c1df.js">
    <link rel="stylesheet" href="/vuepress.github.io/assets/css/0.styles.0b6018b1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="sidebar-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-5 ant-col-xl-5 ant-col-xxl-4"><a href="/vuepress.github.io/" class="router-link-active no-logo home-link"><!----> <span class="site-name">KILLAR'S BLOG</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-19 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><ul role="menu" id="nav" class="ant-menu ant-menu-horizontal ant-menu-root ant-menu-light"><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/vuepress.github.io/" class="router-link-active">
          主页
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/vuepress.github.io/components/blog/">
          博客
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          技术
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          软考
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          生活
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul> <!----></nav></div></div> <!----></header> <aside class="sidebar"><!----> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>数据库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress.github.io/components/database/mysql/" title="MySQL" class="sidebar-link">MySQL</a></li><li><a href="/vuepress.github.io/components/database/mongodb/" aria-current="page" title="MongoDB" class="active sidebar-link">MongoDB</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress.github.io/components/database/mongodb/#mongodb副本集配置（一主一从一仲裁）" title="MongoDB副本集配置（一主一从一仲裁）" class="sidebar-link">MongoDB副本集配置（一主一从一仲裁）</a></li></ul></li><li><a href="/vuepress.github.io/components/database/redis/" title="Redis" class="sidebar-link">Redis</a></li></ul></section></li></ul></aside> <main class="page"> <div class="theme-antdocs-content content__default"><h2 id="mongodb副本集配置（一主一从一仲裁）"><a href="#mongodb副本集配置（一主一从一仲裁）" class="header-anchor">#</a> MongoDB副本集配置（一主一从一仲裁）</h2> <p>环境准备<br>
服务器：Windows2008 R2 MongoDB版本：3.6.5 副本集方案：1主库+1从库+1个仲裁服务器 注意：部署生产环境的时候最好将不同的节点部署在不同的服务器上，我为了演示，因此直接部署在同一台</p> <p>一、安装MongoDB</p> <ol><li>拷贝3份MongoDB到D盘下，目录依次为（实际在数据库运行时，哪个实例是主库是不一定的，但为了区分文件夹，暂且如此起名了）</li></ol> <ul><li>Mongodb_Master    //  192.168.11.29 27311 主库</li> <li>Mongodb_Slaver    //  192.168.11.29 27321 从库</li> <li>Mongodb_Arbiter   //  192.168.11.29 27331 仲裁服务器</li></ul> <img src="/vuepress.github.io/assets/img/database/1.png" alt="变更控制系统"> <ol start="2"><li>主库配置
打开cmd，进入bin目录下，执行以下命令创建主库数据库服务：</li></ol> <div class="language- extra-class"><pre class="language-text"><code>D：\Mondodb\Mongodb_Master\bin&gt;mongod --replSet shard1 --port 27311 --logpath &quot;D:\Mongodb\Mongodb_Master\data\log\mongod.log&quot; --logappend --dbpath &quot;D:\Mongodb\Mongodb_Master\data\db&quot; --serviceName &quot;mongo_master&quot; --serviceDisplayName &quot;mongo_master&quot; --install
</code></pre></div><ol start="3"><li>从库配置
打开cmd，进入bin目录下，执行以下命令创建主库数据库服务：</li></ol> <div class="language- extra-class"><pre class="language-text"><code>D：\Mondodb\Mongodb_Slaver\bin&gt;mongod --replSet shard1 --port 27321 --logpath &quot;D:\Mongodb\Mongodb_Slaver\data\log\mongod.log&quot; --logappend --dbpath &quot;D:\Mongodb\Mongodb_Slaver\data\db&quot; --serviceName &quot;mongo_slaver&quot; --serviceDisplayName &quot;mongo_slaver&quot; --install
</code></pre></div><ol start="4"><li>仲裁服务器配置
打开cmd，进入bin目录下，执行以下命令创建主库数据库服务：</li></ol> <div class="language- extra-class"><pre class="language-text"><code>D：\Mondodb\Mongodb_Arbiter\bin&gt;mongod --replSet shard1 --port 27331 --logpath &quot;D:\Mongodb\Mongodb_Arbiter\data\log\mongod.log&quot; --logappend --dbpath &quot;D:\Mongodb\Mongodb_Arbiter\data\db&quot; --serviceName &quot;mongo_arbiter&quot; --serviceDisplayName &quot;mongo_arbiter&quot; --install

</code></pre></div><ol start="5"><li>启动服务</li></ol> <img src="/vuepress.github.io/assets/img/database/2.png" alt="变更控制系统"> <ol start="6"><li>将三个实例连接在一起</li></ol> <p>（1）打开cmd，进入主库bin目录下，连接：</p> <div class="language- extra-class"><pre class="language-text"><code>D：\Mondodb\Mongodb_Master\bin&gt;mongo –port 27311
</code></pre></div><p>（2）执行mongd 命令：</p> <div class="language- extra-class"><pre class="language-text"><code>&gt;config={_id:'shard1',members:[{_id:0,host:'127.0.0.1:27311'},{_id:1,host:'127.0.0.1:27321'},{_id:3,host:'127.0.0.1:27331', arbiterOnly:true}]}
</code></pre></div><p>（3）说明：_id的值&quot;shard1&quot;是配置名称，多处使用，需统一。members下就是各mongo实例，第三个成员中的arbiterOnly:true表明改成员是仲裁服务器。</p> <p>（4）然后通过下面的指令启动样本集</p> <div class="language- extra-class"><pre class="language-text"><code>&gt;rs.initiate(config)  
</code></pre></div> <img src="/vuepress.github.io/assets/img/database/3.png" alt="变更控制系统"> <p>显示OK，表示副本集创建成功。<br>
当初始化配置信息后，可以明显的看到mongodb的命令行发生了变化，会显示出当前节点所属的副本集名称和节点类型。</p> <img src="/vuepress.github.io/assets/img/database/4.png" alt="变更控制系统"> <p>（5）查询副本集状态</p> <p>使用rs.status()指令查询副本集中各实例的状态，执行结果如下：</p> <img src="/vuepress.github.io/assets/img/database/5.png" alt="变更控制系统"> <img src="/vuepress.github.io/assets/img/database/6.png" alt="变更控制系统"> <p>可以看到副本集中的各成员状态：</p> <ul><li>health: 1   //1表明状态是正常，0表明异常</li> <li>state: 1     // 1表明是主库，2表明是从库，即做备份的机器</li> <li>stateStr: &quot;ARBITER&quot; // ARBITER表明 是仲裁服务器</li></ul> <p>二、测试
打开cmd，进入主库，插入100条随机数据。</p> <img src="/vuepress.github.io/assets/img/database/7.png" alt="变更控制系统"> <p>接着，进入到从库，查看数据，发现已经同步了。</p> <img src="/vuepress.github.io/assets/img/database/8.png" alt="变更控制系统"></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">7/13/2020, 6:27:38 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/vuepress.github.io/components/database/mysql/" class="prev"><i aria-label="icon: left" class="anticon anticon-left"><svg viewBox="64 64 896 896" focusable="false" data-icon="left" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"></path></svg></i>
        MySQL
      </a></span> <span class="next"><a href="/vuepress.github.io/components/database/redis/">
        Redis
        <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> </main> <!----></div><div class="global-ui"><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;right:65px;bottom:0px;width:135px;height:300px;z-index:99999;opacity:0.8;pointer-events:none;"><canvas id="live2d_canvas" width="135" height="300" class="live2d_canvas" style="position:absolute;left:0px;top:0px;width:135px;height:300px;"></canvas></div><div></div></div></div>
    <script src="/vuepress.github.io/assets/js/app.ba1ea9b6.js" defer></script><script src="/vuepress.github.io/assets/js/2.fc02e046.js" defer></script><script src="/vuepress.github.io/assets/js/8.bf485cae.js" defer></script>
  </body>
</html>