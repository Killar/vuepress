(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{845:function(a,t,s){"use strict";s.r(t);var e=s(58),o=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"mongodb副本集配置（一主一从一仲裁）"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mongodb副本集配置（一主一从一仲裁）"}},[a._v("#")]),a._v(" MongoDB副本集配置（一主一从一仲裁）")]),a._v(" "),s("p",[a._v("环境准备"),s("br"),a._v("\n服务器：Windows2008 R2 MongoDB版本：3.6.5 副本集方案：1主库+1从库+1个仲裁服务器 注意：部署生产环境的时候最好将不同的节点部署在不同的服务器上，我为了演示，因此直接部署在同一台")]),a._v(" "),s("p",[a._v("一、安装MongoDB")]),a._v(" "),s("ol",[s("li",[a._v("拷贝3份MongoDB到D盘下，目录依次为（实际在数据库运行时，哪个实例是主库是不一定的，但为了区分文件夹，暂且如此起名了）")])]),a._v(" "),s("ul",[s("li",[a._v("Mongodb_Master    //  192.168.11.29 27311 主库")]),a._v(" "),s("li",[a._v("Mongodb_Slaver    //  192.168.11.29 27321 从库")]),a._v(" "),s("li",[a._v("Mongodb_Arbiter   //  192.168.11.29 27331 仲裁服务器")])]),a._v(" "),s("img",{attrs:{src:a.$withBase("/assets/img/database/1.png"),alt:"变更控制系统"}}),a._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[a._v("主库配置\n打开cmd，进入bin目录下，执行以下命令创建主库数据库服务：")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('D：\\Mondodb\\Mongodb_Master\\bin>mongod --replSet shard1 --port 27311 --logpath "D:\\Mongodb\\Mongodb_Master\\data\\log\\mongod.log" --logappend --dbpath "D:\\Mongodb\\Mongodb_Master\\data\\db" --serviceName "mongo_master" --serviceDisplayName "mongo_master" --install\n')])])]),s("ol",{attrs:{start:"3"}},[s("li",[a._v("从库配置\n打开cmd，进入bin目录下，执行以下命令创建主库数据库服务：")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('D：\\Mondodb\\Mongodb_Slaver\\bin>mongod --replSet shard1 --port 27321 --logpath "D:\\Mongodb\\Mongodb_Slaver\\data\\log\\mongod.log" --logappend --dbpath "D:\\Mongodb\\Mongodb_Slaver\\data\\db" --serviceName "mongo_slaver" --serviceDisplayName "mongo_slaver" --install\n')])])]),s("ol",{attrs:{start:"4"}},[s("li",[a._v("仲裁服务器配置\n打开cmd，进入bin目录下，执行以下命令创建主库数据库服务：")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('D：\\Mondodb\\Mongodb_Arbiter\\bin>mongod --replSet shard1 --port 27331 --logpath "D:\\Mongodb\\Mongodb_Arbiter\\data\\log\\mongod.log" --logappend --dbpath "D:\\Mongodb\\Mongodb_Arbiter\\data\\db" --serviceName "mongo_arbiter" --serviceDisplayName "mongo_arbiter" --install\n\n')])])]),s("ol",{attrs:{start:"5"}},[s("li",[a._v("启动服务")])]),a._v(" "),s("img",{attrs:{src:a.$withBase("/assets/img/database/2.png"),alt:"变更控制系统"}}),a._v(" "),s("ol",{attrs:{start:"6"}},[s("li",[a._v("将三个实例连接在一起")])]),a._v(" "),s("p",[a._v("（1）打开cmd，进入主库bin目录下，连接：")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("D：\\Mondodb\\Mongodb_Master\\bin>mongo –port 27311\n")])])]),s("p",[a._v("（2）执行mongd 命令：")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v(">config={_id:'shard1',members:[{_id:0,host:'127.0.0.1:27311'},{_id:1,host:'127.0.0.1:27321'},{_id:3,host:'127.0.0.1:27331', arbiterOnly:true}]}\n")])])]),s("p",[a._v('（3）说明：_id的值"shard1"是配置名称，多处使用，需统一。members下就是各mongo实例，第三个成员中的arbiterOnly:true表明改成员是仲裁服务器。')]),a._v(" "),s("p",[a._v("（4）然后通过下面的指令启动样本集")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v(">rs.initiate(config)  \n")])])]),a._v(" "),s("img",{attrs:{src:a.$withBase("/assets/img/database/3.png"),alt:"变更控制系统"}}),a._v(" "),s("p",[a._v("显示OK，表示副本集创建成功。"),s("br"),a._v("\n当初始化配置信息后，可以明显的看到mongodb的命令行发生了变化，会显示出当前节点所属的副本集名称和节点类型。")]),a._v(" "),s("img",{attrs:{src:a.$withBase("/assets/img/database/4.png"),alt:"变更控制系统"}}),a._v(" "),s("p",[a._v("（5）查询副本集状态")]),a._v(" "),s("p",[a._v("使用rs.status()指令查询副本集中各实例的状态，执行结果如下：")]),a._v(" "),s("img",{attrs:{src:a.$withBase("/assets/img/database/5.png"),alt:"变更控制系统"}}),a._v(" "),s("img",{attrs:{src:a.$withBase("/assets/img/database/6.png"),alt:"变更控制系统"}}),a._v(" "),s("p",[a._v("可以看到副本集中的各成员状态：")]),a._v(" "),s("ul",[s("li",[a._v("health: 1   //1表明状态是正常，0表明异常")]),a._v(" "),s("li",[a._v("state: 1     // 1表明是主库，2表明是从库，即做备份的机器")]),a._v(" "),s("li",[a._v('stateStr: "ARBITER" // ARBITER表明 是仲裁服务器')])]),a._v(" "),s("p",[a._v("二、测试\n打开cmd，进入主库，插入100条随机数据。")]),a._v(" "),s("img",{attrs:{src:a.$withBase("/assets/img/database/7.png"),alt:"变更控制系统"}}),a._v(" "),s("p",[a._v("接着，进入到从库，查看数据，发现已经同步了。")]),a._v(" "),s("img",{attrs:{src:a.$withBase("/assets/img/database/8.png"),alt:"变更控制系统"}})])}),[],!1,null,null,null);t.default=o.exports}}]);